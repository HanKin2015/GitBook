# V4L2编程
一开始还以为是v412。。。

## 1、简介
V4L2全名是video for linux 2之前还有个老版本v4l,也就是video for linux 1.0版本
V4L2不仅仅用于摄像头,也用于视频输出接口,收音机接口等

我们插入USB,使用dmesg查看usb的输出信息
uvcvideo: Found UVC 1.00 device USB 2.0 Camera (05a3:9310)

搜索内核源码可以找到相关函数
cd linux-3.4.2/
cd drivers/
$ grep "Found UVC" *  -nR
media/video/uvc/uvc_driver.c:1848:      uvc_printk(KERN_INFO, "Found UVC %u.%02x device %s 
这里就涉及到UVC这个名词了,所谓的UVC也就是usb video class类的驱动，也就是USB硬件相关的驱动，也就是应该会向上注册这个驱动程序

## 2、修改hosts文件
vim /etc/hosts增加域名解析

## 3、Linux下七种文件类型

文件类型标识	文件类型
-	普通文件
d	目录
l  	符号链接
s（伪文件）	套接字
b（伪文件）	块设备
c（伪文件）	字符设备
p（伪文件）	管道

占用存储空间的类型：文件、目录、符号链接。符号链接记录的是路径，路径不长时存在innode里面。
其他四种：套接字、块设备、字符设备、管道是伪文件，不占用磁盘空间。

## 4、查看/dev/video0文件信息
linux下usb摄像头操作，离不开v4l2框架
V4L2是Video for linux2的简称,为linux中关于视频设备的内核驱动。在Linux中，视频设备是设备文件，可以像访问普通文件一样对其进行读写，摄像头在/dev/video0下。

v4l2-ctl命令查看video设备参数信息，如果提示如下未找到v4l2-ctl命令，则需要安装v4l-utils

v4l2-ctl -d  /dev/video0 --all
可以通过执行v4l2-ctl --list-devices命令获取vid和pid
v4l2-ctl -d0 --list-formats-ext    查看/dev/video0中所有格式及分辨率

## 5、V4L2编程官网
http://v4l.videotechnology.com/dwg/
https://www.cnblogs.com/wenrenhua08/p/3937736.html


因为 V4L2 可以对多种设备编程，所以并不是所有 API 可以对所有设备编程，哪怕是同类型的设备，使用ioctl--VIDIOC_QUERYCAP 去询问支持什么功能。
```
struct v4l2_capability cap;
rel = ioctl(fdUsbCam, VIDIOC_QUERYCAP, &cap);
if(rel != 0)
{
  perror("ioctl VIDIOC_QUERYCAP");
  return -1;
}
```
结构体如下：
```
struct v4l2_capability
{
  __u8 driver[16];
  __u8 card[32];
  __u8 bus_info[32];
  __u32 version;
  __u32 capabilities;
  __u32 reserved[4];
};
```
这里面最重要的是：capabilities:

头文件 linux/videodev2.h 和 kernel 头文件 linux/videodev2.h 中都有描述：
```
#define V4L2_CAP_VIDEO_CAPTURE		0x00000001  
#define V4L2_CAP_VIDEO_OUTPUT		0x00000002  
#define V4L2_CAP_VIDEO_OVERLAY		0x00000004  
#define V4L2_CAP_VBI_CAPTURE		0x00000010  
#define V4L2_CAP_VBI_OUTPUT		0x00000020  
#define V4L2_CAP_SLICED_VBI_CAPTURE	0x00000040  
#define V4L2_CAP_SLICED_VBI_OUTPUT	0x00000080  
#define V4L2_CAP_RDS_CAPTURE		0x00000100  
#define V4L2_CAP_VIDEO_OUTPUT_OVERLAY	0x00000200  
#define V4L2_CAP_HW_FREQ_SEEK		0x00000400  
#define V4L2_CAP_RDS_OUTPUT		0x00000800  

#define V4L2_CAP_TUNER			0x00010000  
#define V4L2_CAP_AUDIO			0x00020000  
#define V4L2_CAP_RADIO			0x00040000  
#define V4L2_CAP_MODULATOR		0x00080000  

#define V4L2_CAP_READWRITE              0x01000000  
#define V4L2_CAP_ASYNCIO                0x02000000  
#define V4L2_CAP_STREAMING              0x04000000  
```
这里要说到 VBI，Vertical Blanking Interval 的缩写。 电视信号包括一部分非可视信号，它不传送可视信息，因此被称为ⅦI(垂直消隐期间)。VBI 可以用于传送其他信息，通常是一种专用字幕信号, 这和 Blog 重显率中所说暗合。

在这里，V4L2_CAP_VIDEO_CAPTURE 说明设备是个图像采集设备，V4L2_CAP_STREAMING 说明是个 Streaming 设备。 通常，摄像头都支持以上两个能力。


